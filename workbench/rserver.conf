# Posit Workbench Server Configuration File
#
# Full Configuration Reference: https://docs.posit.co/ide/server-pro/admin/reference/rserver_conf.html

#-----------------------------------------------------------------------------------------#
# HTTPS / TLS Configuration
#
# https://docs.posit.co/ide/server-pro/admin/access_and_security/secure_sockets.html
# Configure SSL/TLS for encrypted connections. The certificate key should be owned by
# the rstudio-server user with permissions 600 (chmod 600). Workbench does not support
# passphrase-protected SSL certificates. Restrict to modern TLS versions (1.2, 1.3) for
# security hardening.
#-----------------------------------------------------------------------------------------#
ssl-enabled=1
ssl-certificate=/path/to/certificate/posit.crt
ssl-certificate-key=/path/to/key/posit.key

# Restrict to modern TLS protocols only (security hardening)
# https://docs.posit.co/ide/server-pro/admin/access_and_security/secure_sockets.html#restrict-tls-versions
ssl-protocols=TLSv1.2 TLSv1.3

#-----------------------------------------------------------------------------------------#
# Launcher Configuration
#
# https://docs.posit.co/ide/server-pro/admin/job_launcher/configuration.html#server-options
# Job Launcher enables running sessions in containers, on HPC clusters (Slurm, Kubernetes),
# or on remote compute nodes. Required for Jupyter, VS Code, and distributed computing
# workloads. launcher-sessions-callback-address must be accessible from compute nodes.
#-----------------------------------------------------------------------------------------#
launcher-sessions-enabled=1
launcher-address=127.0.0.1
launcher-port=5559
launcher-default-cluster=Local
launcher-sessions-callback-address=https://{{ REPLACEME }}/

# Enable SSL for launcher communication (recommended for HA and security)
# https://docs.posit.co/ide/server-pro/admin/hardening/example_secure_configuration.html
;launcher-use-ssl=1

#-----------------------------------------------------------------------------------------#
# Admin Dashboard Configuration
#
# https://docs.posit.co/ide/server-pro/admin/server_management/administrative_dashboard.html
# The Admin Dashboard is not enabled by default (accessible at http://<server-address>/admin).
# admin-superuser-group members can: 1) Suspend or terminate active sessions, 2) Assume
# control of active sessions (e.g., for troubleshooting), and 3) Login as any server user.
# admin-monitor-log-use-server-time-zone displays log times in server timezone vs UTC.
#-----------------------------------------------------------------------------------------#
admin-enabled=1
admin-group=posit-admins
admin-superuser-group=posit-super-admin
admin-monitor-log-use-server-time-zone=1

#-----------------------------------------------------------------------------------------#
# Health Check Endpoint
#
# https://docs.posit.co/ide/server-pro/admin/auditing_and_monitoring/server_health_checks.html
# Non-authenticated health check endpoint for monitoring and load balancer health checks.
# Accessible at http://<server-address-and-port>/health-check when enabled. Returns JSON
# with system status, license validity, and resource availability.
#-----------------------------------------------------------------------------------------#
server-health-check-enabled=1

#-----------------------------------------------------------------------------------------#
# Authentication - SAML Single Sign-On
#
# https://docs.posit.co/ide/server-pro/admin/authenticating_users/saml_sso.html
# SAML SSO configuration for enterprise identity providers. Post binding is required for
# many IDPs, most commonly Azure AD. Use auth-saml-metadata-url for internet-connected
# systems or auth-saml-metadata-path for air-gapped deployments.
#-----------------------------------------------------------------------------------------#
;auth-saml=1
;auth-saml-sp-attribute-username=NameID

# Post binding is required for many customer IDPs, most commonly for Azure
;auth-saml-idp-post-binding=1

# For Workbench instances with outbound internet access to the IDP
;auth-saml-metadata-url={{ REPLACEME }}

# For Workbench instances restricted from outbound connections to the IDP
;auth-saml-metadata-path=/etc/rstudio/metadata.xml

#-----------------------------------------------------------------------------------------#
# Authentication - OpenID Connect (OIDC)
#
# https://docs.posit.co/ide/server-pro/admin/authenticating_users/openid_connect_authentication.html
# OpenID Connect authentication for modern OAuth 2.0 identity providers. Requires
# auth-openid-issuer to be set to the IdP's discovery endpoint. The username claim
# (e.g., preferred_username, email) must be specified and match the IdP's token format.
#-----------------------------------------------------------------------------------------#
auth-openid=1
auth-openid-issuer={{ REPLACEME }}
auth-openid-username-claim=preferred_username

#-----------------------------------------------------------------------------------------#
# PAM Session Configuration
#
# https://docs.posit.co/ide/server-pro/admin/access_and_security/pam_sessions.html
# PAM sessions provide authentication and session management for user logins. When using
# the Job Launcher, PAM sessions start on both the server node and potentially on compute
# nodes. If you need PAM sessions for Kerberos or pam_mount, enable
# auth-pam-sessions-use-password to forward credentials to the session.
#-----------------------------------------------------------------------------------------#
auth-pam-sessions-enabled=1
auth-pam-sessions-profile=rstudio

# Forward PAM credentials to sessions (required for Kerberos, pam_mount)
;auth-pam-sessions-use-password=1

#-----------------------------------------------------------------------------------------#
# Auditing Configuration
#
# https://docs.posit.co/ide/server-pro/admin/auditing_and_monitoring/auditing_configuration.html
# Comprehensive auditing of R sessions and console activity. R session auditing logs
# session start/stop/suspend events. R console auditing can log all commands (input) or
# all commands and output (all). JSON format is recommended for structured log processing.
# Logs are stored in audit-data-path with automatic rotation and retention limits.
#-----------------------------------------------------------------------------------------#

# General audit settings
audit-data-path=/var/lib/rstudio-server/audit/

# R Session auditing (session lifecycle events)
audit-r-sessions=1
audit-r-sessions-format=json
audit-r-sessions-limit-mb=2048
audit-r-sessions-limit-months=13

# R Console auditing (command and output logging)
# Options: "input" (commands only) or "all" (commands and output)
;audit-r-console=all
;audit-r-console-format=json
;audit-r-console-user-limit-mb=100

#-----------------------------------------------------------------------------------------#
# Python Package Index Configuration
#
# https://docs.posit.co/ide/server-pro/admin/python/package_installation.html
# Configure the default Python package index (PyPI repository) for Workbench sessions.
# This value is injected into sessions as PIP_INDEX_URL and UV_INDEX_URL, so both pip
# and uv use this repository by default. Useful for pointing to internal Package Manager
# instances or Posit Public Package Manager for faster binary package installations.
#-----------------------------------------------------------------------------------------#
;session-python-index-url=https://packagemanager.posit.co/pypi/latest/simple

# Internal Package Manager (if you have your own instance)
;session-python-index-url=https://packagemanager.company.com/pypi/latest/simple

#-----------------------------------------------------------------------------------------#
# Session Diagnostics
#
# https://docs.posit.co/ide/server-pro/admin/reference/rserver_conf.html#rsession-settings
# Session diagnostics collect detailed debugging information for troubleshooting session
# startup issues. rsession-diagnostics-strace-enabled adds system call tracing (strace)
# for deep debugging. Enable these temporarily when troubleshooting, as they generate
# significant log data.
#-----------------------------------------------------------------------------------------#
;rsession-diagnostics-dir=/var/log/rstudio
;rsession-diagnostics-enabled=1
;rsession-diagnostics-strace-enabled=1

#-----------------------------------------------------------------------------------------#
# Security Hardening Settings
#
# https://docs.posit.co/ide/server-pro/admin/hardening/example_secure_configuration.html
# Recommended security hardening options to restrict access, enforce timeouts, enable
# origin checks (CSRF defense), and prevent clickjacking. These settings align with
# security best practices for enterprise deployments. Adjust www-allow-origin to match
# your Workbench domain.
#-----------------------------------------------------------------------------------------#

# Limit access to specific Unix group membership (recommended)
;auth-required-user-group=posit-users

# Shorter idle timeout (default is 60 minutes, 20 minutes is more secure)
;auth-timeout-minutes=20

# HTTP Strict Transport Security (HSTS) settings for 1 year with subdomains
# https://docs.posit.co/ide/server-pro/admin/access_and_security/secure_sockets.html#use-http-strict-transport-security-hsts
;ssl-hsts-max-age=31536000
;ssl-hsts-include-subdomains=1

# Enable origin checks on all HTTP requests (CSRF defense)
# https://docs.posit.co/ide/server-pro/admin/hardening/browser_security.html
;www-enable-origin-check=1

# Ensure the domain on which Workbench is hosted is permitted as an origin
;www-allow-origin=mysubdomain.mydomain.com

# Set SameSite attribute on all cookies (lax or strict)
;www-same-site=lax

# Prevent embedding Workbench in iframes on other pages (clickjacking defense)
;www-frame-origin=none

#-----------------------------------------------------------------------------------------#
# Load Balancing / High Availability Configuration
#
# https://docs.posit.co/ide/server-pro/admin/load_balancing/configuration.html
# Multi-node Workbench deployment settings. Requires PostgreSQL database and shared
# storage (NFS or similar). All nodes must have identical /etc/rstudio configs (except
# node-specific settings like www-address), shared user accounts/home directories, and
# synchronized clocks. Load balancing enables session resilience and horizontal scaling.
#-----------------------------------------------------------------------------------------#

# Enable load balancing for multi-node deployments
;load-balancing-enabled=1

#-----------------------------------------------------------------------------------------#
# Network Binding Configuration
#
# https://docs.posit.co/ide/server-pro/admin/access_and_security/running_with_a_proxy.html
# Network interface and port binding. For single-server behind a local proxy, bind to
# localhost (127.0.0.1). For load-balanced or externally accessible servers, bind to
# 0.0.0.0 or a specific IP. Leave www-port empty to use default (443 if SSL enabled,
# 8787 otherwise).
#-----------------------------------------------------------------------------------------#

# Bind to all interfaces (required for load balancing or external access)
;www-address=0.0.0.0

# Bind to localhost only (for single-server behind local proxy)
;www-address=127.0.0.1

# Port binding (leave empty for default: 443 with SSL, 8787 without)
;www-port=
